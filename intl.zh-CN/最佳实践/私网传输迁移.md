# 私网传输迁移

如果您能直接从自建机房IDC、虚拟机环境或者云主机访问阿里云某一地域下的专有网络VPC，建议您使用SMC的私网传输迁移方案。通过SMC的私网传输迁移，比公网更快速、更稳定，能提高迁移的效率。

-   已通过VPN网关、高速通道物理专线、智能接入网关将本地数据中心和云上VPC打通。更多信息，请参见[连接本地IDC](/intl.zh-CN/网络连接/VPC与外部网络连接/连接本地IDC.md)。
-   本地数据中心的防火墙已放行8703、8080端口，用于保证迁移源与中转实例数据传输畅通。

SMC的私网传输迁移方案，主要适用于以下场景：

|场景|方案|
|--|--|
|源服务器迁移上云，但没有公网访问能力。|您需要通过VPN网关、高速通道物理专线、智能接入网关将源服务器和云上VPC打通，并为源服务器设置代理服务器，然后通过代理服务器访问SMC实现私网迁移源服务器。|
|源服务器迁移上云，具备公网访问能力，可以直接通过SMC进行公网传输迁移，但迁移速度受限，希望进一步提升迁移的效率。|您需要通过VPN网关、高速通道物理专线、智能接入网关将源服务器和云上VPC打通，然后通过SMC迁移上云时选择私网传输的方式。私网传输的方式相较于公网传输的方式，提高了迁移效率。|

## SMC私网传输迁移流程及操作步骤

SMC私网传输迁移流程如下图所示：

![私网传输迁移](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/6767881161/p236125.png)

迁移流程概述：

1.  下载[SMC客户端](https://p2v-tools.oss-cn-hangzhou.aliyuncs.com/smc/Alibaba_Cloud_Migration_Tool.zip?file=Alibaba_Cloud_Migration_Tool.zip)，并将SMC客户端安装至源服务器。
2.  在源服务器中运行SMC客户端，并通过代理服务器将源服务器导入至SMC服务端。关于代理服务器的更多信息，请参见[正向代理服务器介绍](#section_fef_t9b_m2l)。
3.  在SMC控制台创建私网传输模式的迁移任务，并启动迁移任务。
4.  SMC服务端将根据迁移任务的配置，创建相关资源，并通过打通专线的VPC将源服务器的数据迁移至阿里云。
5.  迁移任务执行过程中，代理服务器将代替源服务器接收来自SMC服务端的指令。例如，迁移任务出错时，SMC服务端会中断迁移并向SMC客户端发送错误日志。

具体的操作步骤如下所示：

1.  在已打通专线的VPC下创建代理服务器。

    **说明：** 如果您的源服务器具备公网访问能力，请跳过该步骤。

    您可以通过阿里云提供的正向代理服务器的镜像，在阿里云上快速搭建代理服务器。代理服务器搭建完成后，必须保证与源服务器网络互通，并能够访问SMC服务端`smc.aliyuncs.com`。关于代理服务器的镜像及配置信息，您可以加入技术支持钉钉群获取，具体操作，请参见[联系我们](/intl.zh-CN/常见问题/联系我们.md)。

2.  下载并安装SMC客户端至源服务器，导入迁移源。

    导入迁移源的具体操作，请参见[步骤一：导入迁移源](/intl.zh-CN/用户指南/步骤一：导入迁移源.md)。在导入过程中，请注意：

    -   如果您不需要使用代理服务器，可以直接导入迁移源。
    -   如果您需要使用代理服务器导入迁移源，当安装SMC客户端完成后，需要先在客户端配置文件中设置代理服务器信息，设置完成后再运行客户端导入迁移源。以Linux系统为例，设置代理服务器信息的操作步骤如下：
        1.  在`go2aliyun_client`目录下，运行以下命令打开`client_data`文件。

            ```
            vim client_data
            ```

        2.  找到如下图所示的`proxy`配置项。

            ![proxy](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/0170561161/p232563.png)

        3.  在`ip_port`配置项后，设置代理服务器的IP地址及端口信息。

            示例配置如下：

            ```
            "proxy": {
                "ip_port": "172.31.**.**:8080",
                "user_pwd": ""
            }
            ```

            配置完成后按下Esc键，然后输入`:wq`并回车，保存退出文件。

3.  在SMC控制台，导入并执行迁移任务。

    具体操作，请参见[步骤二：创建并启动迁移任务](/intl.zh-CN/用户指南/步骤二：创建并启动迁移任务.md)。在创建迁移任务的过程中，需要注意将**网络模式**设置为**私网传输**，并配置已打通专线的VPC以及交换机。

    ![网络模式](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/0170561161/p232570.png)


## 正向代理服务器介绍

如果源服务器不具备公网访问能力，必须通过私网传输的方式才能迁移上云，那么源服务器必须具备以下两个条件：

-   已通过VPN网关、高速通道物理专线、智能接入网关将源服务器和云上VPC打通。
-   源服务器需要通过代理服务器访问SMC服务端，并导入迁移源信息。

本章节主要介绍代理服务器。

正向代理服务器是位于客户端与服务端之间的代理服务器，当客户端不具备公网访问能力，不能直接访问服务端时，可以设置代理服务器与客户端互通，然后通过代理服务器向服务端发送请求，当代理服务器接收响应后，再将响应结果返回至客户端。

![正向代理](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/7407561161/p232634.png)

使用正向代理服务器的主要作用：

-   使客户端可以访问到公网的数据资源。
-   代理服务器可以作为缓存，将常用的公网数据记录在缓存中，第二次访问该类数据时可以直接从缓存中获取，加速资源的访问效率。
-   可以对客户端的访问进行授权，提高安全性。
-   客户端可以通过代理服务器访问任意公网资源并隐藏客户端信息，代理服务器同时会保存客户端的访问记录。

**相关文档**  


[什么是服务器迁移中心](/intl.zh-CN/产品简介/什么是服务器迁移中心.md)

[SMC FAQ](/intl.zh-CN/常见问题/SMC FAQ.md)

