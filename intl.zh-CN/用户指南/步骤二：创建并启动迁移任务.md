# 步骤二：创建并启动迁移任务

导入迁移源信息后，SMC控制台会自动生成迁移源记录，您需要在控制台为迁移源创建迁移任务，并启动任务进行迁移。本文介绍创建迁移任务、启动迁移任务的操作步骤。

-   已导入迁移源信息。详情请参见[步骤一：导入迁移源](/intl.zh-CN/用户指南/步骤一：导入迁移源.md)。
-   迁移源为在线状态。如果迁移源为其他状态，将无法新建迁移任务。修复迁移源状态，请参见[迁移源为非在线状态时，无法创建迁移任务怎么办](/intl.zh-CN/常见问题/SMC FAQ.mdsection_weo_he3_b2a)。

-   SMC能够获取迁移源的磁盘分区结构，在创建迁移任务时自动生成目标磁盘分区。在尽可能保持迁移源磁盘分区结构的同时，提高迁移的传输速率。
-   如果您需要批量添加迁移任务，可以使用SMC提供的模板完成，具体操作步骤请参见[使用Excel模板批量导入迁移任务](/intl.zh-CN/最佳实践/使用Excel模板批量导入迁移任务.md)。

1.  登录[SMC控制台](https://smc.console.aliyun.com/)。

2.  创建迁移任务。

    1.  在左侧导航栏，单击**迁移源**。

    2.  选择要迁移的迁移源。

        您可以从客户端界面获取迁移源ID，如下图所示，并根据迁移源ID找到目标迁移源。查找迁移源，请参见[如何查找迁移源](/intl.zh-CN/常见问题/SMC FAQ.mdsection_7hf_tn4_x5i)。

        ![获取迁移源ID](https://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/0145559951/p50022.png)

    3.  单击**创建迁移任务**。

    4.  在**创建迁移任务**页面，阅读迁移提示并配置迁移任务。

        迁移任务**基本配置**说明：

        -   **目标地域**（必填）：您的源服务器要迁入的阿里云地域ID。地域详情，请参见[地域和可用区](https://www.alibabacloud.com/help/zh/doc-detail/123712.htm)。
        -   **任务名称**：迁移任务的名称。

            **说明：** 同一阿里云地域下，任务名称必须唯一。

        -   **任务描述**：迁移任务的描述。
        -   **目标磁盘（GiB）**：设置目标服务器的磁盘结构。

            ![目标磁盘](https://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/0145559951/p112652.png)

            配置项说明表如下：

            |配置项|是否必选|说明|
            |---|----|--|
            |**是否启用块复制**|否|            -   选中复选框：使用块复制能有效提升迁移传输速度的稳定性，同时能够保证跟源分区结构一致，但分区大小无法修改。此外**分区<N\>**配置项后会生成**是否开启块复制**开关。
            -   不选中复选框：使用默认的文件级别迁移，分区大小可修改。 |
            |**系统盘**|是|            -   **系统盘**：目标阿里云服务器ECS系统盘的大小，单位为GiB。 取值范围：20~500。目标系统盘取值需要大于迁移源系统盘实际占用大小。例如，源系统盘大小为500GiB，实际占用100GiB，则目标系统盘取值需大于100GiB。

**说明：** 默认值为迁移源系统盘大小，如无缩小系统盘容量需要，建议不要小于默认值。

            -   **分区<N\>**：SMC能够根据迁移源的磁盘分区结果自动生成目标磁盘分区，单位为GiB。 取值范围：0~98。变量`<N>`表示第几个分区。如果迁移源的系统盘是单分区结构，则只会生成**分区0**。
            -   **是否开启块复制**：仅当打开上述的**是否启用块复制**开关后，才会出现该开关。SMC会根据迁移源磁盘分区状态进行判断是否支持开启块复制。
                -   如果迁移源不支持分区开启块复制，则该开关无法打开。
                -   如果迁移源支持分区开启块复制，您可以打开开关，实现分区级别的磁盘迁移。 |
            |**数据盘<N\>**|否|            -   **数据盘<N\>**：目标阿里云服务器ECS数据盘的大小，单位为GiB。 取值范围：20~32768。
                -   您可以设置**数据盘**前复选框的选中情况，自行选择是否生成目标数据盘。
                -   变量`<N>`表示第几个数据盘。
                -   目标数据盘取值需要大于迁移源数据盘的实际占用大小。例如，源数据盘大小为500GiB，实际占用100GiB，则目标数据盘取值需大于100GiB。
            -   **分区<N\>**：SMC能够根据迁移源的磁盘分区结果自动生成目标磁盘分区，单位为GiB。 取值范围：0~141。变量`<N>`表示第几个分区。如果迁移源的数据盘是单分区结构，则只会生成**分区0**。
            -   **是否开启块复制**：仅当打开上述的**是否启用块复制**开关后，才会出现该开关。SMC会根据迁移源磁盘分区状态进行判断是否支持开启块复制。
                -   如果迁移源不支持分区开启块复制，则该开关无法打开。
                -   如果迁移源支持分区开启块复制，您可以打开开关，实现分区级别的磁盘迁移。
**说明：** 若您的迁移源没有数据盘，或数据盘未挂载，不会出现**数据盘**配置项。详情请参见[为什么新建迁移任务页面没有出现数据盘配置项？怎么办？](/intl.zh-CN/常见问题/SMC FAQ.md) |

        -   **目标镜像类型**：设置迁移源迁移至阿里云的目标镜像类型。
            -   选择**云服务器镜像**。配置项说明如下：

                |配置项|是否必选|说明|
                |---|----|--|
                |**镜像名称**|否|SMC为迁移源生成的目标阿里云镜像名称。 **说明：** 同一阿里云地域下，镜像名称必须唯一。 |
                |**自动增量同步**|否|迁移任务是否自动同步源服务器增量数据至阿里云。                 -   开启该开关后，需设置以下配置项：

                    -   **同步重复频率**：增量迁移任务周期性自动执行的时间间隔。
                    -   **最大镜像保留数**：增量迁移任务默认保留的最大镜像数。
迁移任务将自动周期性执行，并同步增量数据至阿里云。增量迁移的最佳实践，请参见[增量迁移源服务器](/intl.zh-CN/最佳实践/增量迁移源服务器.md)。

                -   关闭该开关后，迁移任务仅执行一次。 |

            -   选择**容器镜像**。配置项说明如下：

                **说明：** Windows操作系统的迁移源不支持迁移至容器镜像。迁移至容器镜像最佳实践，请参见[源服务器迁移至容器镜像](/intl.zh-CN/最佳实践/源服务器迁移至容器镜像.md)。

                |配置项|是否必选|说明|
                |---|----|--|
                |**容器镜像命名空间**|是|存放迁移生成的容器镜像仓库的命名空间。|
                |**容器镜像仓库名称**|是|存放迁移生成的容器镜像的仓库地址。|
                |**容器镜像版本**|否|存放迁移生成的容器镜像的版本信息。|
                |**容器镜像的RAM角色**|是|绑定中转实例的实例角色。|

        -   **执行方式**：迁移任务的执行方式。

            -   **立即执行**：创建迁移任务后立即启动。
            -   **预约执行**：创建迁移任务后，在设置的时间自动启动迁移任务。

                **说明：** 预约执行时间最早可设置为当前时间后10分钟。

            -   **只创建**：仅创建迁移任务，需要手动启动迁移任务。
            默认值：**立即执行**。

        **标签与网络（可选）**说明：

        -   **迁移任务标签**：为迁移任务绑定标签键值，便于查询与管理迁移任务。

            **说明：** 同一个迁移任务最多可绑定20个标签。

        -   **网络模式**：传输迁移数据到中转实例使用的网络。中转实例会被创建在所选专有网络（VPC）、交换机（VSwitch）下，因此中转实例会被分配公网IP。

            ![网络模式](https://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/0145559951/p112663.png)

            配置项说明表如下：

            |配置项|说明|
            |---|--|
            |**公网传输**|迁移数据通过公网传输到中转实例。使用该模式，源服务器需能访问公网。根据实际需要，选择是否指定专有网络（VPC）和交换机（VSwitch）。             -   指定VPC和VSwitch：迁移任务在您指定的VPC和VSwitch下创建中转实例。

批量迁移时，为每个迁移任务指定相同的VPC和VSwitch，可提高VPC的复用率，每次批量迁移的最大值可达到100台迁移源。

            -   不指定VPC和VSwitch：迁移任务在系统自动新建的VPC和VSwitch下创建中转实例。

批量迁移时，若不指定VPC和VSwitch，SMC会为每个中转实例创建一个VPC。

**说明：** 由于每个账号在一个地域下的VPC限额为10（包括您创建的VPC和SMC自动创建的VPC），因此每次批量迁移的最大值不超过10台迁移源。如需提高VPC限额，请[提交工单](https://workorder.console.aliyun.com/#/ticket/list/)。 |
            |**内网传输**|迁移数据通过VPC内网传输到中转实例。使用该模式，需要将源服务器与阿里云VPC打通，并且必须指定VPC和VSwitch。 **说明：** 如果您能直接从自建机房（Integrated Data Center，IDC）、虚拟机环境或者云主机访问某一阿里云地域下的专有网络VPC，建议您使用该方式进行迁移。使用内网传输能获得比通过公网更快速更稳定的数据传输效果，提高迁移工作效率。您可以通过VPN网关、高速通道物理专线、智能接入网关将源服务器和云上VPC打通。更多详情，请参见[连接本地IDC](/intl.zh-CN/VPC与外部网络连接/连接本地IDC.md)。 |

        **高级配置（可选）**说明：

        -   **传输限速（KB/s）**：迁移过程中，数据传输的带宽上限限制，单位为KB/s。

            默认值：0。表示不限制带宽速度。

        -   **压缩率**：迁移过程中，数据压缩传输的级别。 请根据您的实际需要，设置压缩率。

            -   在带宽有限的环境下，使用高压缩率，可提升数据的传输速度。
            -   在带宽很高的情况下，建议您不压缩传输数据，可减少对迁移源CPU资源的耗费。
            默认值：0。即不压缩传输数据。

        -   **Checksum验证**：开启后，可增强数据一致性校验，但是可能会降低传输速度。

            默认值：关闭。

    5.  配置完成后，单击**确定**。

3.  启动迁移任务。

    **说明：** 为**立即执行**的迁移任务请跳过本步骤。**只创建**或**预约执行**的迁移任务可以按照本步骤手动启动迁移任务。

    1.  在左侧导航栏，单击**迁移任务**。

    2.  找到需要启动的迁移任务，在操作列单击**开始任务**。

        -   如需批量启动迁移任务，勾选多个迁移任务，并单击**开始/重试**。每个迁移任务的状态必须为**未开始**、**已暂停**或**出错**。
        -   如需暂停迁移任务，在迁移任务状态为**同步中**时，单击**操作**列的**暂停任务**。

-   在迁移任务页面等待任务完成。当状态为**已完成**时，表示迁移成功。
    -   如果您选择迁移的目标镜像类型为云服务器镜像，可以按照以下操作使用镜像创建一个新的ECS实例。
        1.  验证迁移结果。该功能将使用阿里云提供的OOS模板ACS-SMC-CreateAndVerifyInstance，自动验证迁移任务生成的镜像能否成功创建实例，并正常启动。
            1.  在操作列单击**验证迁移结果**。
            2.  在弹出的对话框中了解验证流程，并单击**立即验证**。

                您也可以单击**自定义验证脚本参数**，手动配置参数进行验证。

            3.  在**最近一次迁移结果验证状态**列，查看验证结果。
                -   **成功**：表示迁移结果无异常。您可以单击**查看输出参数**了解验证结果。
                -   **失败**：表示迁移结果存在异常。您可以单击**查看原因**了解失败的原因，并根据原因排查问题。
                -   您也可以单击操作列![...](https://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/3079670061/p169257.png)，并单击**前往OOS查看历史验证**获取OOS模板的历史执行信息。
        2.  在操作列单击**创建实例**。

            ![list](https://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/3079670061/p129881.png)

        3.  配置实例信息并完成实例创建，详情请参见[使用自定义镜像创建实例](/intl.zh-CN/实例/创建实例/使用自定义镜像创建实例.md)。
        4.  远程连接实例，检查迁移后的系统，具体操作请参见[迁移Windows服务器后怎么检查系统](/intl.zh-CN/常见问题/SMC FAQ.md)或[迁移Linux服务器后怎么检查系统](/intl.zh-CN/常见问题/SMC FAQ.mdsection_8nx_71l_ksv)。
    -   如果您选择迁移的目标镜像类型为容器镜像，可以使用容器镜像**部署应用**。详情请参见[验证容器镜像](/intl.zh-CN/最佳实践/源服务器迁移至容器镜像.mdsection_840_v5e_lea)。

        ![smc docker](https://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/0939670061/p134837.png)

-   当迁移任务状态为**出错**时，表示迁移失败。此时，您需要：
    1.  在**操作**列，单击**查看日志**。常见错误及修复方案，请参见[SMC FAQ](/intl.zh-CN/常见问题/SMC FAQ.md)。
    2.  在迁移任务页面，重启迁移任务。迁移任务会从上一次结束时的进度处继续迁移。

        **说明：** 如果中转实例已被释放，需要重新迁移，详情请参见[误释放了中转实例怎么办](/intl.zh-CN/常见问题/SMC FAQ.mdsection_1nu_xd1_bip)。


