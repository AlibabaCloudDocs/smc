# 评估迁移时间与测试传输速度

迁移周期主要分为迁移前、迁移过程中、迁移后三部分。迁移周期时长与待迁移服务器的数量和实际数据量成正比，建议您根据实际迁移测试演练进行评估。本文主要介绍迁移过程中这一阶段所需时间的评估方式和传输速度的测试方法。

在SMC迁移过程中，系统会先在您账号下创建一台临时中转实例，再将源服务器数据传输到中转实例，并为中转实例制作阿里云ECS镜像。因此，迁移时间等于数据传输时间与镜像制作时间之和，详情请参见[评估迁移时间](#section_la1_hkl_a7b)。

整个迁移过程中，源服务器到中转实例的传输速度是迁移时间的首要决定因素。传输速度的测试方法，请参见[测试传输速度](#section_9lq_702_evs)。

部分场景中出现的问题原因及处理方式如下所示：

-   数据传输速度小于实际测出的速度时，可能原因及处理方式如下表所示。

    |可能原因|处理方式|
    |----|----|
    |源服务器和中转实例处于不同地域或不同国家。跨地域、跨国际的网络传输相比同地域传输有时较慢。|测试源服务器和阿里云目标区域实例的网络。如果确定为跨地域的原因，您可以：

    -   迁移源服务器到阿里云相同地域并生成镜像，再复制镜像到目标地域。复制镜像的具体操作，请参见[复制镜像](/cn.zh-CN/镜像/自定义镜像/复制镜像.md)。
    -   排查是否为网络服务商问题。 |
    |迁移时使用的是源服务器的出网带宽和中转实例的入网带宽。中转实例的带宽有所限制，默认入方向公网带宽上限是100 Mbps，因此默认情况下，公网传输的最大速度是100 Mbps。|您可以通过以下任一方式进行处理：    -   方式一：通过ECS控制台找到中转实例或目标实例，将实例的固定公网IP转换为按量付费的弹性公网IP后，再将按量付费的弹性公网IP的带宽峰值升配到200 Mbps。弹性公网IP的带宽峰值在升配时需要支付一定的费用。更多信息，请参见[专有网络类型ECS公网IP转为弹性公网IP](/cn.zh-CN/网络/修改IPv4地址/专有网络类型ECS公网IP转为弹性公网IP.md)以及[变更EIP带宽](/cn.zh-CN/实例/升降配实例/修改带宽配置/变更EIP带宽.md)。

**说明：** 当实例的固定公网IP转换为弹性公网IP后，无法再转回固定公网IP，并且弹性公网IP不会随实例的释放而释放。因此您需要在迁移完成后，手动释放按量付费的弹性公网IP，避免产生额外收费。具体操作，请参见[释放EIP](/cn.zh-CN/用户指南/管理按量计费实例/释放EIP.md)。

    -   方式二：如果源服务器能够访问某一阿里云地域下的专有网络VPC，建议您在**迁移任务**中，使用**内网传输**的方式进行迁移。使用内网传输能获得比通过公网更快速更稳定的数据传输效果，提高迁移工作效率。您可以通过VPN网关、高速通道物理专线、智能接入网关将源服务器和云上VPC打通。更多信息，请参见[连接本地IDC](/cn.zh-CN/VPC与外部网络连接/连接本地IDC.md)。 |
    |源服务器性能瓶颈。例如，CPU、内存、磁盘性能等有限，导致SMC传输效率不高。|提升源服务器性能瓶颈。例如，提升CPU、内存、磁盘性能等。|
    |SMC客户端默认是单线程传输，在一些网络环境中可能有瓶颈。|开启多线程加速传输来最大化利用带宽。具体操作，请参见[开启多线程加速传输](/cn.zh-CN/最佳实践/开启多线程加速传输.md)。|

-   源服务器出网带宽速度较低时，处理方式如下所示。

    如果您确认源服务器的出网带宽速度较低，例如10 Mbps以下。您可以在创建SMC迁移任务时，设置**高级配置（可选）**中的**压缩率**配置项。使用高压缩率，可提升数据的传输速度。


**说明：** 本文中的示例仅供参考。

## 评估迁移时间

迁移过程中所需时间的评估方式如下图所示。其中：

-   快照制作速度目前约为30 MB/s。
-   实际网速的测试方法，请参见[测试传输速度](#section_9lq_702_evs)。

![evaluate_migration_time](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/0953449951/p67548.png)

假设有一台服务器系统，磁盘数据的实际占用量为10 GB，出口带宽为10 Mbps，则迁移时间估算如下：

1.  换算单位。

    -   实际数据量为：10 GB=10\*1024=10240 MB
    -   实际网速为：10 Mbps=10/8=1.25 MB/s
2.  计算数据传输时间。

    数据传输时间为：10240/1.25=8192秒=2.27小时

3.  计算镜像制作时间。

    镜像制作时间为：10240/30=341秒=0.09小时

4.  计算迁移时间。

    迁移时间为：2.27+0.09=2.36小时


## 测试传输速度

传输速度是指源服务器到中转实例的传输速度，由源服务器出口带宽速度和中转实例入口带宽速度共同决定。其中，中转实例入口带宽速度默认为200Mbps，您可以提交工单提升速度。

例如：

-   源服务器出口带宽为100 Mbps，中转实例入口带宽为200 Mbps，则实际测出的传输速度理论上不超过100 Mbps。
-   源服务器出口带宽为300 Mbps，中转实例入口带宽为200 Mbps，则实际测出的传输速度理论上不超过200 Mbps。

**说明：** ECS控制台实例显示的带宽1 Mbps为中转实例的出口带宽，由于迁移时使用中转实例的入口带宽，所以1 Mbps不会影响实际迁移速度。

按照以下步骤使用iperf工具测试传输速度：

1.  在阿里云目标地域创建一台按量付费ECS实例。

2.  在实例上，完成以下操作：

    1.  安装iperf工具。

    2.  将iperf启动为服务端。

    3.  在实例安全组中添加规则放开iperf所需端口。

3.  在源服务器系统中，完成以下操作：

    1.  安装iperf工具。

    2.  将iperf启动为客户端。目标服务端IP地址设置为[步骤1](#step_nyw_91l_z4c)中按量付费实例的公网IP地址。


## Linux传输速度测试示例

以下示例步骤以CentOS 7为例。实际测试中，请以您的操作系统版本为准。

1.  在阿里云目标地域创建一台按量付费的CentOS 7实例。

2.  在实例安全组的入方向，添加规则并放行iperf所需端口。

    本示例中，使用iperf的默认端口TCP 5001。

3.  远程连接CentOS 7实例。

4.  在CentOS 7实例上，完成以下操作：

    1.  运行以下命令安装iperf工具。

        ```
        yum -y install iperf3
        ```

    2.  运行以下命令将iperf启动为服务端。

        ```
        iperf3 -s
        ```

5.  在源服务器系统中，完成以下操作：

    1.  下载并安装iperf工具。

    2.  运行以下命令将iperf启动为客户端。

        将命令中的`<实例IP>`替换为已创建实例的公网IP地址。

        ```
        iperf3 -c <实例IP> -i 1 -d  
        ```

6.  等待并记录iperf测试结果。


## Windows传输速度测试示例

以下示例步骤以Windows Server 2008为例。实际测试中，请以您的操作系统版本为准。

1.  在阿里云目标地域创建一台按量付费的Windows Server 2008实例。

2.  在实例安全组的入方向，添加规则并放行iperf所需端口。

    本示例中，使用iperf的默认端口TCP 5001。

3.  远程连接实例。

4.  在Windows Server 2008实例上，完成以下操作：

    1.  下载并安装iperf工具。

    2.  打开cmd窗口。

    3.  运行`cd <iperf所在目录>`命令进入工具目录。

    4.  运行`iperf3.exe -s`命令将iperf启动为服务端。

5.  在源服务器系统中，完成以下操作：

    1.  下载并安装iperf工具。

    2.  运行以下命令将iperf启动为客户端。

        将命令中的`<实例IP>`替换为已创建实例的公网IP地址。

        ```
        iperf3.exe -c <实例IP> -i 1 -d
        ```

6.  等待并记录iperf测试结果。


**相关文档**  


[使用向导创建实例](/cn.zh-CN/实例/创建实例/使用向导创建实例.md)

[添加安全组规则](/cn.zh-CN/安全/安全组/添加安全组规则.md)

[连接方式概述ECS远程连接操作指南](/cn.zh-CN/实例/连接实例/连接方式概述.md)

