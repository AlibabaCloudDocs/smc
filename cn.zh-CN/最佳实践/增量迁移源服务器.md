# 增量迁移源服务器

使用增量迁移可以在自定义的时间间隔内，将源服务器系统产生的增量数据同步至阿里云，有效减少源服务器系统业务暂停时间及最终交割时间。本文介绍增量迁移最佳实践的操作步骤。

已将源服务器信息导入SMC控制台。具体步骤，请参见[步骤一：导入迁移源](/cn.zh-CN/用户指南/步骤一：导入迁移源.md)。

**说明：**

-   SMC客户端从2.0.0版本开始支持增量迁移，因此请使用[2.0.0及以上版本客户端](http://p2v-tools.oss-cn-hangzhou.aliyuncs.com/smc/Alibaba_Cloud_Migration_Tool.zip)导入迁移源。
-   迁移任务执行过程中请保持SMC客户端处于运行状态。如果数据传输中断，重新运行客户端并重新启动迁移任务即可继续迁移。

增量迁移任务会创建中转实例辅助迁移，中转实例会产生少量的费用。费用详情，请参见[按量付费](/cn.zh-CN/产品定价/按量付费.md)。仅当增量迁移任务为**过期**状态或任务被删除时，中转实例才会被清理释放。

## 操作步骤

增量迁移的最佳实践步骤如下：

1.  [（可选）步骤一：过滤动态数据目录](#section_bek_cm0_0tr)

2.  [步骤二：创建并启动增量迁移任务](#section_jq3_f9e_out)

3.  [步骤三：暂停业务并运行增量迁移](#section_p6e_8ju_nzd)


## （可选）步骤一：过滤动态数据目录

为确保迁移更加稳定，建议您在增量迁移前，先排除动态数据目录（如大型数据库的数据目录等），等到业务暂停后再迁移。若无需过滤动态数据目录，可跳过本节步骤。

在源服务器系统业务不暂停的情况下，过滤掉源服务器系统的动态数据目录。具体步骤如下：

1.  登录源服务器。

2.  配置SMC客户端，排除动态数据目录。

    具体操作，请参见[排除不迁移的文件或目录](/cn.zh-CN/用户指南/步骤一：导入迁移源.mdstep_pln_qm7_6rn)。


## 步骤二：创建并启动增量迁移任务

在源服务器系统业务不暂停的情况下，通过SMC控制台创建并启动增量迁移任务。具体步骤如下：

1.  登录[SMC控制台](https://smc.console.aliyun.com/)。

2.  在左侧导航栏，单击**迁移源**。

3.  在待迁移的源服务器的**操作**列，单击**创建迁移任务**。

4.  在**创建迁移任务**页面，打开**自动增量同步**开关，并设置**同步重复频率**和**最大镜像保留数**。完成页面其他配置项，然后单击**确定**。

    ![自动增量同步](https://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/6853449951/p64669.png)

    部分配置项说明如下。其他配置项详情，请参见[迁移任务配置项说明表](/cn.zh-CN/用户指南/步骤二：创建并启动迁移任务.md)。

    -   **同步重复频率**：表示增量迁移任务同步数据的时间间隔。
    -   **最大镜像保留数**：表示最多为您保留的镜像个数。每次增量迁移都会生成新的镜像，当生成的镜像文件总数超过该值时，最早生成且未被使用的镜像将被删除。
    -   **执行方式**：根据您的实际需要设置该值。本教程选择**立即执行**。
    迁移任务创建后立即开始执行。执行结果如下：

    1.  除已过滤掉的目录和文件外，第一次增量迁移会全量迁移源服务器系统的数据，并生成全量镜像。 您可以使用该镜像创建实例进行验证。
    2.  第一次增量迁移完成后，SMC会根据您设置的**同步重复频率**，在相应时间点，自动运行增量迁移并生成新的镜像。

        **说明：** 每次增量迁移生成的镜像，均为源服务器当前时刻的全量镜像，包括迁移时刻的增量数据和之前已迁移的全部数据。

        增量镜像名称中的`CYCLE_X`，用于标识该镜像由第X次增量迁移生成。如下图所示，表示该镜像由第2次增量迁移生成。

        ![cycle](https://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/6853449951/p63594.png)


## 步骤三：暂停业务并运行增量迁移

选择合适的时间点，暂停源服务器系统业务后，放开之前过滤掉的数据目录并再次运行增量迁移。具体步骤如下：

1.  登录源服务器。暂停系统业务，并放开之前过滤掉的数据目录。

2.  在SMC控制台，手动运行增量迁移任务或等待迁移任务自动执行。手动运行增量迁移任务的步骤如下：

    1.  在迁移任务页面，选中目标迁移任务。

    2.  在**操作**列，单击**手动增量迁移**。

        ![手动增量迁移](https://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/6853449951/p63448.png)

    3.  在开始迁移任务对话框，单击**确定**。


在迁移任务页面，等待增量迁移任务完成。

-   当任务状态为**等待中**，表示任务已完成，您将得到最终时间点的镜像。该镜像包含了源服务器系统第一次全量迁移和后续每次增量迁移的全部数据。
-   当任务状态为**出错**，表示任务已失败。您需要查看日志，修复问题后，再重启任务。常见错误及修复方案，请参见[SMC FAQ](/cn.zh-CN/常见问题/SMC FAQ.md)。

得到最终镜像后，您可以：

-   创建实例验证镜像。具体步骤如下：
    1.  在迁移任务页面，找到目标迁移任务，在**操作**列，单击**创建实例**。
    2.  在自定义购买页面，**镜像**区域已设置为第一次增量迁移生成的镜像。按照页面提示，完成其他配置项并购买实例。具体操作，请参见[使用向导创建实例](/cn.zh-CN/实例/创建实例/使用向导创建实例.md)。

        ![](https://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/6853449951/p64719.png)

    3.  远程连接实例，检查迁移后的系统，详情请参见[迁移Windows服务器后怎么检查系统](/cn.zh-CN/常见问题/SMC FAQ.md)或[迁移Linux服务器后怎么检查系统](/cn.zh-CN/常见问题/SMC FAQ.mdsection_8nx_71l_ksv)。
-   暂停增量迁移任务。具体步骤如下：

    **说明：** 仅当增量迁移任务状态为**同步中**或**等待中**时，您才可以暂停该任务。

    1.  在迁移任务页面，选中目标迁移任务。
    2.  在**操作**列，单击![more](https://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/6853449951/p63650.png)\>**暂停**。
    3.  在暂停迁移任务对话框，单击**确定**。
-   删除增量迁移任务。具体步骤如下：
    1.  在迁移任务页面，选中目标迁移任务。
    2.  在**操作**列，单击**删除**。
    3.  在删除迁移任务对话框，单击**确定**。

